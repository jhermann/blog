<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><link rel="shortcut icon" type="image/x-icon" href="/blog/favicon.ico"><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Enabling Easy Zipapp Installs on Windows | Snakes on Callisto</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="Enabling Easy Zipapp Installs on Windows" />
<meta name="author" content="J√ºrgen Hermann" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="How to prepare a Windows system for a good PYZ experience." />
<meta property="og:description" content="How to prepare a Windows system for a good PYZ experience." />
<link rel="canonical" href="https://jhermann.github.io/blog/python/deployment/2020/02/29/python_zippapps_on_windows.html" />
<meta property="og:url" content="https://jhermann.github.io/blog/python/deployment/2020/02/29/python_zippapps_on_windows.html" />
<meta property="og:site_name" content="Snakes on Callisto" />
<meta property="og:image" content="https://jhermann.github.io/blog/images/copied_from_nb/img/python/python+windows.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-02-29T00:00:00-06:00" />
<script type="application/ld+json">
{"mainEntityOfPage":{"@type":"WebPage","@id":"https://jhermann.github.io/blog/python/deployment/2020/02/29/python_zippapps_on_windows.html"},"author":{"@type":"Person","name":"J√ºrgen Hermann"},"image":"https://jhermann.github.io/blog/images/copied_from_nb/img/python/python+windows.png","description":"How to prepare a Windows system for a good PYZ experience.","@type":"BlogPosting","url":"https://jhermann.github.io/blog/python/deployment/2020/02/29/python_zippapps_on_windows.html","headline":"Enabling Easy Zipapp Installs on Windows","dateModified":"2020-02-29T00:00:00-06:00","datePublished":"2020-02-29T00:00:00-06:00","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

  <link href="https://unpkg.com/@primer/css/dist/primer.css" rel="stylesheet" />
  <link rel="stylesheet" href="/blog/assets/main.css">
  <link rel="stylesheet" href="/blog/assets/custom.css">
  <link rel="stylesheet" href="//use.fontawesome.com/releases/v5.0.7/css/all.css"><link type="application/atom+xml" rel="alternate" href="https://jhermann.github.io/blog/feed.xml" title="Snakes on Callisto" />

  <script>
  function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
  }
  window.onload = wrap_img;
  </script>

  <script>
    document.addEventListener("DOMContentLoaded", function(){
      // add link icon to anchor tags
      var elem = document.querySelectorAll(".anchor-link")
      elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
      // remove paragraph tags in rendered toc (happens from notebooks)
      var toctags = document.querySelectorAll(".toc-entry")
      toctags.forEach(e => (e.firstElementChild.innerText = e.firstElementChild.innerText.replace('¬∂', '')))
    });
  </script>
</head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/blog/">Snakes on Callisto</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/blog/about/">üë§Ô∏è About Me</a><a class="page-link" href="/blog/search/">üîéÔ∏è Search</a><a class="page-link" href="/blog/categories/">üìÇÔ∏è Categories</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Enabling Easy Zipapp Installs on Windows</h1><p class="page-description">How to prepare a Windows system for a good PYZ experience.</p><p class="post-meta post-meta-title"><time class="dt-published" datetime="2020-02-29T00:00:00-06:00" itemprop="datePublished">
        2020-02-29
      </time>‚Ä¢ 
          <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <span class="p-author h-card" itemprop="name">jhermann</span></span>
       ‚Ä¢ <span class="read-time" title="Estimated read time">
    
    
      3 min read
    
</span></p>

    
      <p class="category-tags"><i class="fas fa-tags category-tags-icon"></i></i> 
      
        <a class="category-tags-link" href="/blog/categories/#python">python</a>
        &nbsp;
      
        <a class="category-tags-link" href="/blog/categories/#deployment">deployment</a>
        
      
      </p>
    

    
      
        <div class="pb-5 d-flex flex-wrap flex-justify-end">
          <div class="px-2">
<a href="https://github.com/jhermann/blog/tree/master/_notebooks/2020-02-29-python_zippapps_on_windows.ipynb" role="button">
    <img class="notebook-badge-image" src="https://img.shields.io/static/v1?label=&message=View%20On%20GitHub&color=586069&logo=github&labelColor=2f363d">
</a>
</div><div class="px-2">
    <a href="https://colab.research.google.com/github/jhermann/blog/blob/master/_notebooks/2020-02-29-python_zippapps_on_windows.ipynb">
        <img class="notebook-badge-image" src="https://colab.research.google.com/assets/colab-badge.svg" alt="Open In Colab"/>
    </a>
</div>
        </div>
      </header>

  <div class="post-content e-content" itemprop="articleBody">
    <!--
#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: _notebooks/2020-02-29-python_zippapps_on_windows.ipynb
-->

<div class="container" id="notebook-container">
        
    
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><img src="/blog/images/copied_from_nb/img/python/python+windows.png" alt="" /></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Zipapps-in-a-Nutshell">Zipapps in a Nutshell<a class="anchor-link" href="#Zipapps-in-a-Nutshell">&#182;</a></h2><p>Zipapps are a way to distribute Python applications
and all of their dependencies in a single binary file.
This is comparable to statically linked golang apps or Java's ‚Äòexecutable JARs‚Äô. 
Their main advantage is that distributing and installing them is quite simple.</p>
<p>Running Python code directly from ZIP archives is nothing new, <a href="https://www.python.org/dev/peps/pep-0273/">PEP 273</a> made its debut in 2001, as part of Python 2.3 in the form of the <code>zipimport</code> module.
<a href="https://www.python.org/dev/peps/pep-0441/">PEP 441</a> builds on this and describes mechanisms to bundle full applications into a single ZIP file that can be made executable. It was approved in 2015 and a first implementation appeared in Python 3.5 via the <code>zipapp</code> module.</p>
<p>See the PEP for details on how making a ZIP into an executable file works, but basically on POSIX systems the Python interpreter is called in a ‚Äòbang path‚Äô that is followed by the ZIP archive. The interpreter recognizes the ‚Äòscript‚Äô is a whole application archive and acts accordingly. On Windows, zipapps <em>MUST</em> carry the <code>.pyz</code> extension which is bound to the <code>py</code> wrapper command, which in turn looks at the bang path and calls a matching Python interpreter from the installed set.</p>
<p>To display the bang path of a zipapp, use this command:</p>

<pre><code>python3 -m zipapp --info foo.pyz

</code></pre>
<p>If you want to change the requested Python version to one that is actually installed or that you prefer, change the bang path as part of the installation process:</p>

<pre><code>python3 -m zipapp -p '/usr/bin/env python3.8' -o ~/bin/foo foo.pyz

</code></pre>
<p>This can also be done on an ad-hoc basis, by explicitly calling the desired interpreter:</p>

<pre><code>python3.8 foo.pyz ‚Ä¶  # POSIX
py -3.8 foo.pyz ‚Ä¶    # Windows

</code></pre>
<p>Well-known tools to build new zipapps, outside of the Python core, are <a href="https://github.com/pantsbuild/pex">pex</a> (Twitter) and <a href="https://github.com/linkedin/shiv">shiv</a> (LinkedIn). See their documentation for details on bundling your own applications.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Setting-Up-Windows-10-for-Zipapps">Setting Up Windows 10 for Zipapps<a class="anchor-link" href="#Setting-Up-Windows-10-for-Zipapps">&#182;</a></h2><p>On Windows, because there is no ‚Äò+x‚Äô flag, things are a bit more complicated than on POSIX.
Zipapps <strong>MUST</strong> have a <code>.pyz</code> extension,
for which the <code>py</code> launcher is registered as the default application.
The net effect is that such files become executable and are handed over to the launcher
<em>if</em> you add a few environment settings to your machine.</p>
<p>In the user-specific environment settings, add a new <code>PATHEXT</code> variable
(or extend an existing one), with the value <code>%PATHEXT%;.PYZ</code>.
Also edit the <code>PATH</code> one and add a new <code>%LOCALAPPDATA%\bin</code> entry.
Save everything (click ‚ÄúOK‚Äù), open a <em>new</em> command window, and verify
the changes with</p>

<pre><code> echo %PATHEXT% &amp; echo %PATH%

</code></pre>
<p>Create the new bin directory by calling <code>md %LOCALAPPDATA%\bin</code>.
Now you can place a zipapp file like <code>foo.pyz</code> in that directory,
and it is immediately callable as <code>foo</code>.</p>
<p>To get such a test subject, you can build 
<a href="https://github.com/linkedin/shiv">shiv</a> with itself:</p>

<pre><code>git clone https://github.com/linkedin/shiv.git
cd shiv
py -3 -m venv --prompt shiv venv
venv\Scripts\activate.bat
python -m pip install -e .
shiv -e shiv.cli:main -o %LOCALAPPDATA%\bin\shiv.pyz .
deactivate
shiv --version</code></pre>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Variations">Variations<a class="anchor-link" href="#Variations">&#182;</a></h2><p>If that makes more sense to you, you can change the system-wide
variables instead of the user-specific ones, and choose paths that are
global for all users (like <code>C:\usr\bin</code> or similar).</p>
<p>To make zipapps available network-wide, you can use <code>%APPDATA%</code> to store the zipapps,
so you only have to maintain them once in case you regularly
work on several machines in the same network. Just make sure the same version of Python is used everywhere then.</p>

</div>
</div>
</div>
</div>


  </div><!-- from https://github.com/utterance/utterances -->
<script src="https://utteranc.es/client.js"
        repo="jhermann/blog"
        issue-term="title"
        label="blogpost-comment"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script><a class="u-url" href="/blog/python/deployment/2020/02/29/python_zippapps_on_windows.html" hidden></a>
</article>
      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/blog/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Snakes on Callisto</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Snakes on Callisto</li><li><a class="u-email" href="mailto:jh@web.de">jh@web.de</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list">
  <li><a href="https://github.com/jhermann"><svg class="social svg-icon"><use xlink:href="/blog/assets/minima-social-icons.svg#github"></use></svg> <span class="username">jhermann</span></a></li><li><a href="https://www.twitter.com/jhermann_"><svg class="social svg-icon"><use xlink:href="/blog/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">jhermann_</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>Python¬†¬∑ Jupyter(Hub)¬†¬∑ DevSecOps¬†¬∑ Software Architecture¬†¬∑ Systems Design¬†¬∑ Distributed Systems</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
